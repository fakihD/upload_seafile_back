request = require 'request'
config = require './config'
querystring = require 'query-string'

this.get = (endpoint, params, token, cb)->
	if typeof cb == "undefined"
    cb = token;
    token = null;

	paramString = '?' + querystring.stringify params
	url = getUrl(endpoint) + paramString
	request.get {url:url, headers: {'Authorization': 'Token ' + token, 'Accept': 'application/json'}}, (err, res, body)->
		cb(err, body, res)

this.post = (endpoint, params, token, cb)->
	if typeof cb == "undefined"
		cb = token
		token = null

	url = getUrl endpoint
	paramString = querystring.stringify params, encode:false
	request.post {url: url, form: paramString, headers: {'Authorization': 'Token ' + token, 'Accept': 'application/json'}}, (err, res, body)->
		cb(err, body, res)


getUrl = (endpoint)->
	url = config.url + '/api2/' + endpoint + '/'
	url

module.exports = this
