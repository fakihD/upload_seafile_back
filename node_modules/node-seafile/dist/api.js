(function() {
  var config, getUrl, querystring, request;

  request = require('request');

  config = require('./config');

  querystring = require('query-string');

  this.get = function(endpoint, params, token, cb) {
    var paramString, url;
    if (typeof cb === "undefined") {
      cb = token;
      token = null;
    }
    paramString = '?' + querystring.stringify(params);
    url = getUrl(endpoint) + paramString;
    return request.get({
      url: url,
      headers: {
        'Authorization': 'Token ' + token,
        'Accept': 'application/json'
      }
    }, function(err, res, body) {
      return cb(err, body, res);
    });
  };

  this.post = function(endpoint, params, token, cb) {
    var paramString, url;
    if (typeof cb === "undefined") {
      cb = token;
      token = null;
    }
    url = getUrl(endpoint);
    paramString = querystring.stringify(params, {
      encode: false
    });
    return request.post({
      url: url,
      form: paramString,
      headers: {
        'Authorization': 'Token ' + token,
        'Accept': 'application/json'
      }
    }, function(err, res, body) {
      return cb(err, body, res);
    });
  };

  getUrl = function(endpoint) {
    var url;
    url = config.url + '/api2/' + endpoint + '/';
    return url;
  };

  module.exports = this;

}).call(this);
